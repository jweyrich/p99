<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P99: P99_CALL_VA_ARG</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">P99
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="group__default__arguments.html">Default arguments and types for functions</a></li>  </ul>
</div>
</div><!-- top -->
<div class="contents">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td valign="top">
      <div class="navtab">
        <table>
          <tr><td class="navtab"><a class="qindex" href="group__default__arguments_ga534b64dc507e3fc55edf96006e532eea.html#ga534b64dc507e3fc55edf96006e532eea">P99_CALL_DEFARG</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__default__arguments_ga69b2187bb0e91a56c471cb19a1c3d9fb.html#ga69b2187bb0e91a56c471cb19a1c3d9fb">P99_CALL_DEFARG_LIST</a></td></tr>
          <tr><td class="navtab"><a class="qindexHL" href="group__default__arguments_ga1ab494ddea95bb2d2f87f5eed1898b1c.html#ga1ab494ddea95bb2d2f87f5eed1898b1c">P99_CALL_VA_ARG</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__default__arguments_ga118e9c06ec0818f31fd1ada56b30c7d1.html#ga118e9c06ec0818f31fd1ada56b30c7d1">P99_DECLARE_DEFARG</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__default__arguments_ga4918cf7a052529294962b223e25dd1d7.html#ga4918cf7a052529294962b223e25dd1d7">P99_DEFARG_DOCU</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__default__arguments_ga03f50eb13156ed43232aea25cf6784fe.html#ga03f50eb13156ed43232aea25cf6784fe">P99_DEFINE_DEFARG</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__default__arguments_gad3ae3bc406d8c25cbe260fbe76ba989c.html#gad3ae3bc406d8c25cbe260fbe76ba989c">P99_INSTANTIATE</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__default__arguments_gad246cad7a697b694ecf0bbda6e0cbb35.html#gad246cad7a697b694ecf0bbda6e0cbb35">P99_PROTOTYPE</a></td></tr>
        </table>
      </div>
   </td>
   <td valign="top" class="mempage">
<a id="ga1ab494ddea95bb2d2f87f5eed1898b1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1ab494ddea95bb2d2f87f5eed1898b1c">&#9670;&nbsp;</a></span>P99_CALL_VA_ARG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P99_CALL_VA_ARG</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">NAME, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">M, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">T, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;NAME(__VA_ARGS__)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Assure type safety for variadic functions. </p>
<p>Variadic functions in C have a big loophole in that they don't enforce the types for parameters that are given to the ... list. This may have severe consequences when you pass constants as arguments to such functions and the resulting type differs from what is expected.</p>
<p>A classical example is <code>NULL</code>, which may be an integral 0 of any type <em>or</em> <code></code>(void*)0. Suppose a function </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> toto_raw(<span class="keywordtype">size_t</span> len, ...);</div>
</div><!-- fragment --><p>expects the parameter <code>len</code>, followed by a list of arguments expected to be <code>void*</code>. Consider the following three calls to <code>toto_raw:</code> </p><div class="fragment"><div class="line">toto_raw(2, NULL, malloc(23));</div>
<div class="line">toto_raw(2, 0, malloc(23));</div>
<div class="line">toto_raw(2, (<span class="keywordtype">void</span>*)0, malloc(23));</div>
</div><!-- fragment --><p>Depending on the compiler, the first two might both result in an <code>(int)0</code> being put on the stack. <code>sizeof(int)</code> might for example be 4 and <code>sizeof(void*)</code> be 8, so the program would crash. C has no automatic way to detect that since the interface of <code>toto_raw</code> simply can't specify which types the function expects.</p>
<p><a class="el" href="group__default__arguments_ga1ab494ddea95bb2d2f87f5eed1898b1c.html#ga1ab494ddea95bb2d2f87f5eed1898b1c" title="Assure type safety for variadic functions.">P99_CALL_VA_ARG</a> allows you to "declare" the type of the ... arguments. </p><div class="fragment"><div class="line"><span class="preprocessor">#define toto(...) P99_CALL_VA_ARG(toto_raw, 1, void*, __VA_ARGS__)</span></div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">NAME</td><td>is the name of the variadic function that is to be called </td></tr>
    <tr><td class="paramname">M</td><td>is the number of arguments of <em>NAME</em> before the ... </td></tr>
    <tr><td class="paramname">T</td><td>is the conversion type of the ... arguments</td></tr>
  </table>
  </dd>
</dl>
<p>All the following calls of <code>toto</code> result in valid calls of <code>toto_raw</code> and only put <code>void*</code> values in the variadic list: </p><div class="fragment"><div class="line">toto(0);</div>
<div class="line">toto(1, NULL);</div>
<div class="line">toto(1, 0);</div>
<div class="line">toto(1, (<span class="keywordtype">void</span>*)0);</div>
<div class="line">toto(2, NULL, malloc(23));</div>
<div class="line">toto(2, 0, malloc(23));</div>
<div class="line">toto(2, (<span class="keywordtype">void</span>*)0, malloc(23));</div>
</div><!-- fragment --><p>The conversion of the arguments to type <em>T</em> is done with <a class="el" href="group__integers_ga931e021d2b5ae8c8ae2e5190f2d8a3f1.html#ga931e021d2b5ae8c8ae2e5190f2d8a3f1" title="Define an rvalue of type T and (if given) value VAL.">P99_RVAL</a>. So all values passed in the variadic list must be assignment compatible with type <em>T</em>.</p>
<p>This macro also allows you to declare default values for the <em>M</em> first arguments. We could for example do </p><div class="fragment"><div class="line"><span class="preprocessor">#define toto_defarg_0() 0</span></div>
</div><!-- fragment --><p>Then calling <code>toto</code> without arguments would be valid: </p><div class="fragment"><div class="line">toto();</div>
</div><!-- fragment --><p>The convention for these symbols is that the number at the end corresponds to the position of the argument, starting from 0. This may be a macro, as above, or a function. We could have achieved the same effect by declaring </p><div class="fragment"><div class="line"><span class="keyword">inline</span> <span class="keywordtype">size_t</span> toto_defarg_0(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> 0; }</div>
</div><!-- fragment --><p>The arguments in the variadic list may have not only a default type but may have a default value, too. </p><div class="fragment"><div class="line"><span class="preprocessor">#define toto_defarg() ((void*)0)</span></div>
</div><!-- fragment --><p>By that </p><div class="fragment"><div class="line">toto(1,);</div>
</div><!-- fragment --><p> would expand to something equivalent to </p><div class="fragment"><div class="line">toto(1, (<span class="keywordtype">void</span>*)0);</div>
</div><!-- fragment --><p>The naming convention is similar to that stated above for the numbered arguments, only that the suffix "_N" is omitted from the name of the function or macro. </p>

<p class="definition">Definition at line <a class="el" href="p99__defarg_8h_source.html#l00424">424</a> of file <a class="el" href="p99__defarg_8h_source.html">p99_defarg.h</a>.</p>

</div>
</div>
    </td>
  </tr>
</table>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
