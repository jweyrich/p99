<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P99: Generic type expressions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">P99
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle">
<div class="title">Generic type expressions<div class="ingroups"><a class="el" href="group__P99.html">P99</a> &raquo; <a class="el" href="group__compiler.html">Compiler Specific Tuning and Extensions</a> &raquo; <a class="el" href="group__C11.html">Emulating features of C11</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for Generic type expressions:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="group__generic.png" border="0" usemap="#group____generic" alt=""/></div>
<map name="group____generic" id="group____generic">
<area shape="rect" href="group__tgprint.html" title=" " alt="" coords="511,5,695,36"/>
<area shape="rect" href="group__C11__types.html" title=" " alt="" coords="507,60,698,131"/>
<area shape="rect" href="group__qualifiers.html" title=" " alt="" coords="501,155,704,206"/>
<area shape="rect" href="group__constexpr.html" title=" " alt="" coords="501,230,704,281"/>
<area shape="rect" title=" " alt="" coords="227,123,453,153"/>
<area shape="rect" href="group__C11.html" title=" " alt="" coords="5,113,179,163"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__C11__types"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__C11__types.html">Generic identification of families of types or values</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__qualifiers"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__qualifiers.html">determine type related properties</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__tgprint"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tgprint.html">type generic printing</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__constexpr"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__constexpr.html">Compile time constant expressions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gadfd5094a355923e6ad86356422fbb972"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__generic_gadfd5094a355923e6ad86356422fbb972.html#gadfd5094a355923e6ad86356422fbb972">P99_GENERIC</a>(...)</td></tr>
<tr class="memdesc:gadfd5094a355923e6ad86356422fbb972"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type generic expression in anticipation of C11 <code>_Generic</code>.  <a href="group__generic_gadfd5094a355923e6ad86356422fbb972.html#gadfd5094a355923e6ad86356422fbb972">More...</a><br /></td></tr>
<tr class="separator:gadfd5094a355923e6ad86356422fbb972"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4b130d1087a8cc97e561caf90ddc7285"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__generic_ga4b130d1087a8cc97e561caf90ddc7285.html#ga4b130d1087a8cc97e561caf90ddc7285">P99_GENERIC_LIT</a>(...)</td></tr>
<tr class="memdesc:ga4b130d1087a8cc97e561caf90ddc7285"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each generic choice return a compound literal of the chosen type.  <a href="group__generic_ga4b130d1087a8cc97e561caf90ddc7285.html#ga4b130d1087a8cc97e561caf90ddc7285">More...</a><br /></td></tr>
<tr class="separator:ga4b130d1087a8cc97e561caf90ddc7285"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa0e03c90e67c3f4af1b057435eee5745"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__generic_gaa0e03c90e67c3f4af1b057435eee5745.html#gaa0e03c90e67c3f4af1b057435eee5745">P99_GENERIC_SIZE</a>(UI, ...)</td></tr>
<tr class="memdesc:gaa0e03c90e67c3f4af1b057435eee5745"><td class="mdescLeft">&#160;</td><td class="mdescRight">Similar to <a class="el" href="group__generic_gadfd5094a355923e6ad86356422fbb972.html#gadfd5094a355923e6ad86356422fbb972" title="Type generic expression in anticipation of C11 _Generic.">P99_GENERIC</a> but the choice is not according to the type of the expression <em>UI</em> but to its unsigned value.  <a href="group__generic_gaa0e03c90e67c3f4af1b057435eee5745.html#gaa0e03c90e67c3f4af1b057435eee5745">More...</a><br /></td></tr>
<tr class="separator:gaa0e03c90e67c3f4af1b057435eee5745"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacb915854647e7f1919e6c45ddb576c75"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__generic_gacb915854647e7f1919e6c45ddb576c75.html#gacb915854647e7f1919e6c45ddb576c75">P99_GENERIC_SIZE_LIT</a>(UI, ...)</td></tr>
<tr class="memdesc:gacb915854647e7f1919e6c45ddb576c75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Similar to <a class="el" href="group__generic_gaa0e03c90e67c3f4af1b057435eee5745.html#gaa0e03c90e67c3f4af1b057435eee5745" title="Similar to P99_GENERIC but the choice is not according to the type of the expression UI but to its un...">P99_GENERIC_SIZE</a> but returns a compound literal of the chosen type.  <a href="group__generic_gacb915854647e7f1919e6c45ddb576c75.html#gacb915854647e7f1919e6c45ddb576c75">More...</a><br /></td></tr>
<tr class="separator:gacb915854647e7f1919e6c45ddb576c75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8e3cb69914277c628755949524187893"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__generic_ga8e3cb69914277c628755949524187893.html#ga8e3cb69914277c628755949524187893">P99_IN_RANGE</a>(R,  S,  L)&#160;&#160;&#160;P00_IN_RANGE((R), (S), (L), P00_IN_RANGE_LIST())</td></tr>
<tr class="memdesc:ga8e3cb69914277c628755949524187893"><td class="mdescLeft">&#160;</td><td class="mdescRight">check if <em>R</em> is in the range [<em>S</em>, <em>S</em> + <em>L</em>)  <a href="group__generic_ga8e3cb69914277c628755949524187893.html#ga8e3cb69914277c628755949524187893">More...</a><br /></td></tr>
<tr class="separator:ga8e3cb69914277c628755949524187893"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf2c10f0af126c95aac270e3244bd51ae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__generic_gaf2c10f0af126c95aac270e3244bd51ae.html#gaf2c10f0af126c95aac270e3244bd51ae">P99_TYPED_TERN</a>(COND,  YES,  NO)</td></tr>
<tr class="memdesc:gaf2c10f0af126c95aac270e3244bd51ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">A compile time ternary operator that is analogous to <code>COND ? YES : NO</code> that keeps the type of the chosen expression.  <a href="group__generic_gaf2c10f0af126c95aac270e3244bd51ae.html#gaf2c10f0af126c95aac270e3244bd51ae">More...</a><br /></td></tr>
<tr class="separator:gaf2c10f0af126c95aac270e3244bd51ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>C11 provides a new feature to write template-like expressions with the macro preprocessor, <code>_Generic</code>. Here we provide some tools that emulate this feature by means of gcc specific extensions.</p>
<p><code>_Generic</code> is one single construct which could be seen as an analogue to a <code>switch</code> statement, only that the different choices are made with matching types and not values. A typical example is</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define sin(X) _Generic((X), default: sin, float: sinf, long double: sinld)(X)</span></div>
</div><!-- fragment --><p>In contrast to that single construct, in C++ there are a several of constructs that would be needed to implement similar functionalities: function overloading, templates, constexpr.</p>
<p>Type generic expressions have an important new feature that was difficult to implement before C11:</p>
<ul>
<li>the <b>type</b> of the result of such an expression depends on the type or value of the "choice" expression.</li>
</ul>
<p>C++ has a construct that decides on the type of an expression, but which is less powerful: function overloading. The actual function that is called at any point depends on the types of its arguments. E.g in</p>
<div class="fragment"><div class="line">b = abs(a);</div>
</div><!-- fragment --><p>the return type of the function call would depend on the type of <code>a</code>, for that simple example it should be the same type as <code>a</code>.</p>
<p>Such simple type generic functions can be implemented through macros in C11 without problems. They have the advantage that the result must not necessarily be a function call but can be any type of expression, in particular constants. This can be convenient in a context for which optimization is crucial, either for CPU efficiency or size of the code. To enforce similar optimizations as with C11 <code>_Generic</code>, you'd have to use the new <code>constexpr</code> feature in C++ in the declaration of the functions that is used.</p>
<p>But <code>_Generic</code> is more powerful than that. It also can take such "code" branches according to a value, examples:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define TOTO_APPROX(X) P99_TYPED_TERN(sizeof(toto) &gt; 4, toto_ld(X), toto_d(X))</span></div>
</div><!-- fragment --><p>Using <code>_Generic</code> underneath <a class="el" href="group__generic_gaf2c10f0af126c95aac270e3244bd51ae.html#gaf2c10f0af126c95aac270e3244bd51ae" title="A compile time ternary operator that is analogous to COND ? YES : NO that keeps the type of the chose...">P99_TYPED_TERN</a>, this defines a function-like macro <code>TOTO_APPROX</code> that chooses between to functions according to the size of a type <code>toto</code>. The result type is the type of any of the branches that is chosen. The two types need not be compatible.</p>
<p>The choice expression (<code>sizeof</code> ...) is not known during preprocessing phases, so an <code><a class="el" href="group__C11__library_ga266905272bfd862bb322e93dfb83949b.html#ga266905272bfd862bb322e93dfb83949b">if</a>/#else</code> preprocessor conditional could not be used for the same purpose.On the other hand a conventional ternary expression</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define TOTO_APPROX0(X) (sizeof(toto) &gt; 4 ? toto_ld(X) : toto_d(X))</span></div>
</div><!-- fragment --><p>would impose that the return types of the two functions would have to be compatible (both arithmetic types or both pointer types, e.g). If both were arithmetic types the result of the whole would be the wider of the two types. If e.g <code>toto_ld</code> would return <code>long double</code> and <code>toto_d</code> only <code>double</code>, in any case the result of the whole would still be <code>long double</code>,</p>
<p>In C++, one would need a template class that would be parametrized with a <code>bool</code> to obtain the same effect.</p>
<p>&lt; should I leave this in? sounds a bit complicated &gt;</p>
<ul>
<li>if <code>FLT_EVAL_METHOD</code> is 2 (all floating point operations are performed in <code>long double<code>) cast the expression down to <code>double</code> </code></code></li>
</ul>
<p><code><code></p><div class="fragment"><div class="line"><span class="preprocessor">#define FLOATING_EVAL(X) P99_GENERIC_SIZE(10+FLT_EVAL_METHOD, (X), (12, (double)(X)))</span></div>
<div class="line"> </div>
<div class="line">printf(<span class="stringliteral">&quot;toto is %f\n&quot;</span>, FLOATING_EVAL(x * y))</div>
</div><!-- fragment --><p></code></code></p>
<p><code><code>This would ensure that the <code>printf</code> call would never see a <code>long double<code>, even if the arguments are only <code>float</code> or <code>double</code>.</code></code></code></code></p>
<p><code><code><code><code></p><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__generic_gadfd5094a355923e6ad86356422fbb972.html#gadfd5094a355923e6ad86356422fbb972" title="Type generic expression in anticipation of C11 _Generic.">P99_GENERIC</a> </dd></dl>
<p></code></code></code></code></p>
</div><!-- contents -->
<div class="ttc" id="agroup__generic_ga4b130d1087a8cc97e561caf90ddc7285_html_ga4b130d1087a8cc97e561caf90ddc7285"><div class="ttname"><a href="group__generic_ga4b130d1087a8cc97e561caf90ddc7285.html#ga4b130d1087a8cc97e561caf90ddc7285">P99_GENERIC_LIT</a></div><div class="ttdeci">#define P99_GENERIC_LIT(...)</div><div class="ttdoc">For each generic choice return a compound literal of the chosen type.</div><div class="ttdef"><b>Definition:</b> <a href="p99__generic_8h_source.html#l00720">p99_generic.h:720</a></div></div>
<div class="ttc" id="ap99__str_8h_acd5465f6b44ffc9448f6876c140bfa7f_html_acd5465f6b44ffc9448f6876c140bfa7f"><div class="ttname"><a href="p99__str_8h_acd5465f6b44ffc9448f6876c140bfa7f.html#acd5465f6b44ffc9448f6876c140bfa7f">uintmax_t</a></div><div class="ttdeci">uintmax_t</div><div class="ttdef"><b>Definition:</b> <a href="p99__str_8h_source.html#l00109">p99_str.h:109</a></div></div>
<div class="ttc" id="agroup__generic_gadfd5094a355923e6ad86356422fbb972_html_gadfd5094a355923e6ad86356422fbb972"><div class="ttname"><a href="group__generic_gadfd5094a355923e6ad86356422fbb972.html#gadfd5094a355923e6ad86356422fbb972">P99_GENERIC</a></div><div class="ttdeci">#define P99_GENERIC(...)</div><div class="ttdoc">Type generic expression in anticipation of C11 _Generic.</div><div class="ttdef"><b>Definition:</b> <a href="p99__generic_8h_source.html#l00699">p99_generic.h:699</a></div></div>
<div class="ttc" id="agroup__generic_gaa0e03c90e67c3f4af1b057435eee5745_html_gaa0e03c90e67c3f4af1b057435eee5745"><div class="ttname"><a href="group__generic_gaa0e03c90e67c3f4af1b057435eee5745.html#gaa0e03c90e67c3f4af1b057435eee5745">P99_GENERIC_SIZE</a></div><div class="ttdeci">#define P99_GENERIC_SIZE(UI,...)</div><div class="ttdoc">Similar to P99_GENERIC but the choice is not according to the type of the expression UI but to its un...</div><div class="ttdef"><b>Definition:</b> <a href="p99__generic_8h_source.html#l00753">p99_generic.h:753</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
